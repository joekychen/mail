<!DOCTYPE html>
<html><head><title>joekychen/mail » lib › mail › utilities.rb

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>utilities.rb</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>encoding: utf-8</p></td><td class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">Mail</span>
  <span class="k">module</span> <span class="nn">Utilities</span>
    <span class="kp">include</span> <span class="no">Patterns</span>
    </pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Returns true if the string supplied is free from characters not allowed as an ATOM</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">atom_safe?</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="ow">not</span> <span class="no">ATOM_UNSAFE</span> <span class="o">===</span> <span class="n">str</span>
    <span class="k">end</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>If the string supplied has ATOM unsafe characters in it, will return the string quoted 
in double quotes, otherwise returns the string unmodified</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">quote_atom</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">atom_safe?</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span> <span class="p">?</span> <span class="n">str</span> <span class="p">:</span> <span class="n">dquote</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="k">end</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>If the string supplied has PHRASE unsafe characters in it, will return the string quoted 
in double quotes, otherwise returns the string unmodified</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">quote_phrase</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="k">if</span> <span class="no">RUBY_VERSION</span> <span class="o">&gt;=</span> <span class="s1">&#39;1.9&#39;</span>
        <span class="n">original_encoding</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="n">encoding</span>
        <span class="n">str</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="s1">&#39;ASCII-8BIT&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="no">PHRASE_UNSAFE</span> <span class="o">===</span> <span class="n">str</span><span class="p">)</span>
          <span class="n">dquote</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="n">original_encoding</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="n">str</span><span class="o">.</span><span class="n">force_encoding</span><span class="p">(</span><span class="n">original_encoding</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">else</span>
        <span class="p">(</span><span class="no">PHRASE_UNSAFE</span> <span class="o">===</span> <span class="n">str</span><span class="p">)</span> <span class="p">?</span> <span class="n">dquote</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="p">:</span> <span class="n">str</span>
      <span class="k">end</span>
    <span class="k">end</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Returns true if the string supplied is free from characters not allowed as a TOKEN</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">token_safe?</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="ow">not</span> <span class="no">TOKEN_UNSAFE</span> <span class="o">===</span> <span class="n">str</span>
    <span class="k">end</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>If the string supplied has TOKEN unsafe characters in it, will return the string quoted 
in double quotes, otherwise returns the string unmodified</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">quote_token</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">token_safe?</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span> <span class="p">?</span> <span class="n">str</span> <span class="p">:</span> <span class="n">dquote</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="k">end</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Wraps supplied string in double quotes unless it is already wrapped.</p>

<p>Additionally will escape any double quotation marks in the string with a single
backslash in front of the '"' character.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dquote</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">match</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^&quot;(.*)?&quot;$/</span><span class="p">)</span>
      <span class="n">str</span> <span class="o">=</span> <span class="n">match</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="k">if</span> <span class="n">match</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>First remove all escaped double quotes:</p></td><td class="code"><div class="highlight"><pre>      <span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\\&quot;/</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Then wrap and re-escape all double quotes</p></td><td class="code"><div class="highlight"><pre>      <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">str</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[&quot;]/n</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="s1">&#39;\\&#39;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Unwraps supplied string from inside double quotes.</p>

<p>Example:</p>

<p>string = '"This is a string"'
 unquote(string) #=> 'This is a string'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unquote</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">match</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^&quot;(.*?)&quot;$/</span><span class="p">)</span>
      <span class="n">match</span> <span class="p">?</span> <span class="n">match</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="p">:</span> <span class="n">str</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Wraps a string in parenthesis and escapes any that are in the string itself.</p>

<p>Example:</p>

<p>paren( 'This is a string' ) #=> '(This is a string)'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">paren</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="no">RubyVer</span><span class="o">.</span><span class="n">paren</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Unwraps a string from being wrapped in parenthesis</p>

<p>Example:</p>

<p>str = '(This is a string)'
 unparen( str ) #=> 'This is a string'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unparen</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">match</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^\((.*?)\)$/</span><span class="p">)</span>
      <span class="n">match</span> <span class="p">?</span> <span class="n">match</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="p">:</span> <span class="n">str</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Wraps a string in angle brackets and escapes any that are in the string itself</p>

<p>Example:</p>

<p>bracket( 'This is a string' ) #=> '<This is a string>'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">bracket</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="no">RubyVer</span><span class="o">.</span><span class="n">bracket</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Unwraps a string from being wrapped in parenthesis</p>

<p>Example:</p>

<p>str = '<This is a string>'
 unbracket( str ) #=> 'This is a string'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unbracket</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">match</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^\&lt;(.*?)\&gt;$/</span><span class="p">)</span>
      <span class="n">match</span> <span class="p">?</span> <span class="n">match</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="p">:</span> <span class="n">str</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Escape parenthesies in a string</p>

<p>Example:</p>

<p>str = 'This is (a) string'
 escape_paren( str ) #=> 'This is (a) string'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">escape_paren</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="no">RubyVer</span><span class="o">.</span><span class="n">escape_paren</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
    <span class="k">end</span>
    
    <span class="k">def</span> <span class="nf">uri_escape</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">uri_parser</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="k">end</span>
    
    <span class="k">def</span> <span class="nf">uri_unescape</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">uri_parser</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="k">end</span>
    
    <span class="k">def</span> <span class="nf">uri_parser</span>
      <span class="vi">@uri_parser</span> <span class="o">||=</span> <span class="no">URI</span><span class="o">.</span><span class="n">const_defined?</span><span class="p">(</span><span class="ss">:Parser</span><span class="p">)</span> <span class="p">?</span> <span class="no">URI</span><span class="o">::</span><span class="no">Parser</span><span class="o">.</span><span class="n">new</span> <span class="p">:</span> <span class="no">URI</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Matches two objects with their to_s values case insensitively</p>

<p>Example:</p>

<p>obj2 = "This<em>is</em>An<em>object"
 obj1 = :this</em>IS<em>an</em>object
 match<em>to</em>s( obj1, obj2 ) #=> true</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">match_to_s</span><span class="p">(</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">obj2</span> <span class="p">)</span>
      <span class="n">obj1</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">downcase</span> <span class="o">==</span> <span class="n">obj2</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">downcase</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Capitalizes a string that is joined by hyphens correctly.</p>

<p>Example:</p>

<p>string = 'resent-from-field'
 capitalize_field( string ) #=> 'Resent-From-Field'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">capitalize_field</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">str</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Takes an underscored word and turns it into a class name</p>

<p>Example:</p>

<p>constantize("hello") #=> "Hello"
 constantize("hello-there") #=> "HelloThere"
 constantize("hello-there-mate") #=> "HelloThereMate"</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">constantize</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">str</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/[-_]/</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">}</span><span class="o">.</span><span class="n">to_s</span>
    <span class="k">end</span>
    </pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Swaps out all underscores (_) for hyphens (-) good for stringing from symbols
a field name.</p>

<p>Example:</p>

<p>string = :resent<em>from</em>field
 dasherize ( string ) #=> 'resent<em>from</em>field'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dasherize</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">str</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">end</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Swaps out all hyphens (-) for underscores (_) good for stringing to symbols
a field name.</p>

<p>Example:</p>

<p>string = :resent<em>from</em>field
 underscoreize ( string ) #=> 'resent<em>from</em>field'</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">underscoreize</span><span class="p">(</span> <span class="n">str</span> <span class="p">)</span>
      <span class="n">str</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">downcase</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="no">RUBY_VERSION</span> <span class="o">&lt;=</span> <span class="s1">&#39;1.8.6&#39;</span>

      <span class="k">def</span> <span class="nf">map_lines</span><span class="p">(</span> <span class="n">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span> <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="o">[]</span>
        <span class="n">str</span><span class="o">.</span><span class="n">each_line</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
          <span class="n">results</span> <span class="o">&lt;&lt;</span> <span class="k">yield</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">results</span>
      <span class="k">end</span>
  
      <span class="k">def</span> <span class="nf">map_with_index</span><span class="p">(</span> <span class="n">enum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span> <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="o">[]</span>
        <span class="n">enum</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">token</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
          <span class="n">results</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">yield</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">results</span>
      <span class="k">end</span>
      
    <span class="k">else</span>

      <span class="k">def</span> <span class="nf">map_lines</span><span class="p">(</span> <span class="n">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span> <span class="p">)</span>
        <span class="n">str</span><span class="o">.</span><span class="n">each_line</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">map_with_index</span><span class="p">(</span> <span class="n">enum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span> <span class="p">)</span>
        <span class="n">enum</span><span class="o">.</span><span class="n">each_with_index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="k">end</span>

    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/mail",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
